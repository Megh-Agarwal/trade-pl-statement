const publicVapidKey="BI6jIHYbytCsLCBK-D38d6XfcUpoznzdEGAlMVbDu-LeGTjsI4N4T5SEEC9wl-jw6WFKsJ0h9FqYcFFvbGlso7g";async function send(){const t=await navigator.serviceWorker.register("/worker.js",{scope:"/"});t.installing||t.waiting||t.active,0 in window,Notification.permission,checkForNotifications(await t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:urlBase64ToUint8Array(publicVapidKey)}))}function urlBase64ToUint8Array(t){t=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const e=window.atob(t),i=new Uint8Array(e.length);for(let t=0;t<e.length;++t)i[t]=e.charCodeAt(t);return i}function createNotificationMessage(t,e){let i="than",o=("equal"==t.condition&&(i="to"),"price");return"total"==t.type&&(o="total gain and loss"),{title:`Alert for ${t.combined}!`,body:`${t.name}'s (current price is $${e}) ${o} has reached ${t.condition} ${i} $`+t.value}}function checkForNotifications(p){let g=[],e=[],u=[],i=[],d=[],S=[],y="",N=[];for(var o in localStorage.notifications&&(g=JSON.parse(localStorage.notifications)),localStorage.coinWiseTrades&&(e=JSON.parse(localStorage.coinWiseTrades)),y=(y=localStorage.idLogsForNotifications?localStorage.idLogsForNotifications:y).split(","),localStorage.notificationLogs&&(N=JSON.parse(localStorage.notificationLogs)),g){let t=JSON.parse(g[o]);0==t.status&&(d[t.name.toLowerCase()]||(d[t.name.toLowerCase()]=[]),d[t.name.toLowerCase()].push(t),i.push(t.name.toLowerCase()))}for(var a in e){let t=JSON.parse(e[a]);u[t.name.toLowerCase()]=t}if(setInterval(function(){S=[]},3e5),i!=[]){const t=new WebSocket("wss://ws.coincap.io/prices?assets="+i.join(","));t.onmessage=function(t){var a,e=JSON.parse(t.data);for(a in e){let o=parseFloat(e[a]);for(var n in d[a]){let t=d[a][n];var s=parseFloat(t.value),r=new Date(t.expiry),c=new Date;let e=!1,i=o;if(0==t.status){if(c<=r)"total"==t.type&&(c=o*parseFloat(u[a].volume),i=c-parseFloat(u[a].cost)),("equal"==t.condition&&i==s||"more"==t.condition&&i>=s||"less"==t.condition&&i<=s)&&(e=!0);else{for(var l in t.status=1,d[a][parseFloat(n)]=JSON.stringify(t),g)JSON.parse(g[l]).id==t.id&&(g[l]=JSON.stringify(t));localStorage.setItem("notifications",JSON.stringify(g))}if(1==e){if("once"==t.option){for(var f in t.status=1,d[a][parseFloat(n)]=JSON.stringify(t),g)JSON.parse(g[f]).id==t.id&&(g[f]=JSON.stringify(t));localStorage.setItem("notifications",JSON.stringify(g))}S.includes(n)||(y.includes(t.id.toString())&&(r=createNotificationMessage(t,o),N.push(JSON.stringify({notification:t,currentPrice:o,message:r,timestamp:Date.now()})),localStorage.setItem("notificationLogs",JSON.stringify(N))),(async()=>{await fetch("/notify",{method:"POST",body:JSON.stringify({subscription:p,notification:t,currentPrice:o}),headers:{"content-type":"application/json"}})})(),S.push(n))}}}}}}}"serviceWorker"in navigator&&send().catch(t=>{});