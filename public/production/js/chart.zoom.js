!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("chart.js"),require("hammerjs"),require("chart.js/helpers")):"function"==typeof define&&define.amd?define(["chart.js","hammerjs","chart.js/helpers"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).ChartZoom=t(e.Chart,e.Hammer,e.Chart.helpers)}(this,function(e,t,p){"use strict";var s=(t=t)&&"object"==typeof t&&"default"in t?t:{default:t};const m=e=>e&&e.enabled&&e.modifierKey,u=(e,t)=>e&&t[e+"Key"],d=(e,t)=>e&&!t[e+"Key"];function g(e,t,n){return void 0===e||("string"==typeof e?-1!==e.indexOf(t):"function"==typeof e&&-1!==e({chart:n}).indexOf(t))}function h(t,e,n){e=function({x:t,y:n},e){var o=e.scales,a=Object.keys(o);for(let e=0;e<a.length;e++){var i=o[a[e]];if(n>=i.top&&n<=i.bottom&&t>=i.left&&t<=i.right)return i}return null}(e,n);if(e&&g(t,e.axis,n))return[e];const o=[];return p.each(n.scales,function(e){g(t,e.axis,n)||o.push(e)}),o}const o=new WeakMap;function x(e){let t=o.get(e);return t||(t={originalScaleLimits:{},updatedScaleLimits:{},handlers:{},panDelta:{}},o.set(e,t)),t}function i(e,t,n){var o=e.max-e.min,t=o*(t-1),n=e.isHorizontal()?n.x:n.y,n=(e.getValueForPixel(n)-e.min)/o||0;return{min:t*n,max:t*(1-n)}}function v(e,t,n,o,a){let i=n[o];if("original"===i){const n=e.originalScaleLimits[t.id][o];i=p.valueOrDefault(n.options,n.scale)}return p.valueOrDefault(i,a)}function y(e,{min:t,max:n},o,a=!1){const i=x(e.chart),{id:r,axis:l,options:c}=e,s=o&&(o[r]||o[l])||{},{minRange:m=0}=s,u=v(i,e,s,"min",-1/0),d=v(i,e,s,"max",1/0),f=Math.max(t,u),h=Math.min(n,d),p=a?Math.max(h-f,m):e.max-e.min;if(h-f!==p)if(h-p<u)n=(t=f)+p;else if(d<f+p)t=(n=h)-p;else{const e=(p-h+f)/2;t=f-e,n=h+e}else t=f,n=h;return c.min=t,c.max=n,i.updatedScaleLimits[e.id]={min:t,max:n},e.parse(t)!==e.min||e.parse(n)!==e.max}const r=e=>0===e||isNaN(e)?0:e<0?Math.min(Math.round(e),-1):Math.max(Math.round(e),1),l={second:500,minute:3e4,hour:18e5,day:432e5,week:3024e5,month:1296e6,quarter:5184e6,year:157248e5};function a(e,t,n,o=!1){var{min:a,max:i,options:r}=e,r=r.time&&r.time.round,r=l[r]||0,a=e.getValueForPixel(e.getPixelForValue(a+r)-t),i=e.getValueForPixel(e.getPixelForValue(i+r)-t),{min:r=-1/0,max:t=1/0}=o&&n&&n[e.axis]||{};return!!(isNaN(a)||isNaN(i)||a<r||t<i)||y(e,{min:a,max:i},n,o)}function n(e,t,n){return a(e,t,n,!0)}const c={category:function(e,t,n,o){var a,n=i(e,t,n);return e.min===e.max&&t<1&&(a=(t=e).getLabels().length-1,0<t.min&&--t.min,t.max<a&&(t.max+=1)),y(e,{min:e.min+r(n.min),max:e.max-r(n.max)},o,!0)},default:function(e,t,n,o){t=i(e,t,n);return y(e,{min:e.min+t.min,max:e.max-t.max},o,!0)}},f={category:function(e,t,n){var o=e.getLabels().length-1;let{min:a,max:i}=e;var r=Math.max(i-a,1),l=Math.round(((l=e).isHorizontal()?l.width:l.height)/Math.max(r,10)),c=Math.round(Math.abs(t/l));let s;return t<-l?(i=Math.min(i+c,o),a=1===r?i:i-r,s=i===o):l<t&&(a=Math.max(0,a-c),i=1===r?a:a+r,s=0===a),y(e,{min:a,max:i},n)||s},default:a,logarithmic:n,timeseries:n};function b(n,o){p.each(n,(e,t)=>{o[t]||delete n[t]})}function z(e,t){const n=e["scales"],{originalScaleLimits:o,updatedScaleLimits:a}=t;return p.each(n,function(e){!function(e,t,n){var{id:e,options:{min:o,max:a}}=e;if(!t[e]||!n[e])return 1;t=n[e];return t.min!==o||t.max!==a}(e,o,a)||(o[e.id]={min:{scale:e.min,options:e.options.min},max:{scale:e.max,options:e.options.max}})}),b(o,n),b(a,n),o}function M(e,t,n,o){var a=c[e.type]||c.default;p.callback(a,[e,t,n,o])}function k(e,t,n="none"){const{x:o=1,y:a=1,focalPoint:i=(t=e,{x:((t=t.chartArea).left+t.right)/2,y:(t.top+t.bottom)/2})}="number"==typeof t?{x:t,y:t}:t,r=x(e),{limits:l,zoom:c}=r["options"],{mode:s="xy",overScaleMode:m}=c||{};z(e,r);const u=1!==o&&g(s,"x",e),d=1!==a&&g(s,"y",e),f=m&&h(m,i,e);p.each(f||e.scales,function(e){e.isHorizontal()&&u?M(e,o,i,l):!e.isHorizontal()&&d&&M(e,a,i,l)}),e.update(n),p.callback(c.onZoom,[{chart:e}])}function w(e,t,n){t=e.getValueForPixel(t),e=e.getValueForPixel(n);return{min:Math.min(t,e),max:Math.max(t,e)}}function S(e,t,n,o){const a=o["panDelta"],i=a[e.id]||0;p.sign(i)===p.sign(t)&&(t+=i);o=f[e.type]||f.default;p.callback(o,[e,t,n])?a[e.id]=0:a[e.id]=t}function P(e,t,n,o="none"){const{x:a=0,y:i=0}="number"==typeof t?{x:t,y:t}:t,r=x(e),{pan:l,limits:c}=r["options"],{mode:s="xy",onPan:m}=l||{},u=(z(e,r),0!==a&&g(s,"x",e)),d=0!==i&&g(s,"y",e);p.each(n||e.scales,function(e){e.isHorizontal()&&u?S(e,a,c,r):!e.isHorizontal()&&d&&S(e,i,c,r)}),e.update(o),p.callback(m,[{chart:e}])}function C(e,t){const n=x(e)["handlers"],o=n[t];o&&o.target&&(o.target.removeEventListener(t,o),delete n[t])}function j(t,e,n,o){const{handlers:a,options:i}=x(t);C(t,n),a[n]=e=>o(t,e,i),(a[n].target=e).addEventListener(n,a[n])}function Z(e,t){const n=x(e);n.dragStart&&(n.dragging=!0,n.dragEnd=t,e.update("none"))}function R(e,t,n){var{onZoomStart:o,onZoomRejected:a}=n;if(o){const{left:n,top:i}=t.target.getBoundingClientRect(),r={x:t.clientX-n,y:t.clientY-i};if(!1===p.callback(o,[{chart:e,event:t,point:r}]))return p.callback(a,[{chart:e,event:t}]),!1}}function Y(e,t){const n=x(e),{pan:o,zoom:a={}}=n.options;if(u(m(o),t)||d(m(a.drag),t))return p.callback(a.onZoomRejected,[{chart:e,event:t}]);!1!==R(e,t,a)&&(n.dragStart=t,j(e,e.canvas,"mousemove",Z))}function L(e,t,n,o){var{left:a,top:i}=n.target.getBoundingClientRect(),r=g(t,"x",e),t=g(t,"y",e);let{top:l,left:c,right:s,bottom:m,width:u,height:d}=e.chartArea;r&&(c=Math.min(n.clientX,o.clientX)-a,s=Math.max(n.clientX,o.clientX)-a),t&&(l=Math.min(n.clientY,o.clientY)-i,m=Math.max(n.clientY,o.clientY)-i);e=s-c,a=m-l;return{left:c,top:l,right:s,bottom:m,width:e,height:a,zoomX:r&&e?1+(u-e)/u:1,zoomY:t&&a?1+(d-a)/d:1}}function E(e,t){const n=x(e);if(n.dragStart){C(e,"mousemove");var{mode:o,onZoomComplete:a,drag:{threshold:i=0}}=n.options.zoom,t=L(e,o,n.dragStart,t),r=g(o,"x",e)?t.width:0,o=g(o,"y",e)?t.height:0,r=Math.sqrt(r*r+o*o);if(n.dragStart=n.dragEnd=null,r<=i)return n.dragging=!1,void e.update("none");{o=e;var l={x:t.left,y:t.top};var c={x:t.right,y:t.bottom};const s=x(o),{limits:m,zoom:u}=s["options"],{mode:d="xy"}=u,f=(z(o,s),g(d,"x",o)),h=g(d,"y",o);p.each(o.scales,function(e){e.isHorizontal()&&f?y(e,w(e,l.x,c.x),m,!0):!e.isHorizontal()&&h&&y(e,w(e,l.y,c.y),m,!0)}),o.update("zoom"),p.callback(u.onZoom,[{chart:o}])}setTimeout(()=>n.dragging=!1,500),p.callback(a,[{chart:e}])}}function F(e,t){const{handlers:{onZoomComplete:n},options:{zoom:o}}=x(e);var a;!function(e,t,n){if(d(m(n.wheel),t))p.callback(n.onZoomRejected,[{chart:e,event:t}]);else if(!1!==R(e,t,n)&&(t.cancelable&&t.preventDefault(),void 0!==t.deltaY))return 1}(e,t,o)||(a=t.target.getBoundingClientRect(),k(e,{x:e=1+(0<=t.deltaY?-o.wheel.speed:o.wheel.speed),y:e,focalPoint:{x:t.clientX-a.left,y:t.clientY-a.top}}),n&&n())}function X(e,t,n){var o,a,i,r,l;t.scale&&({center:o,pointers:r}=n,a=1/t.scale*n.scale,i=n.target.getBoundingClientRect(),r=function(e,t){var n=Math.abs(e.clientX-t.clientX),e=Math.abs(e.clientY-t.clientY),t=n/e;let o,a;return.3<t&&t<1.7?o=a=!0:e<n?o=!0:a=!0,{x:o,y:a}}(r[0],r[1]),l=t.options.zoom.mode,k(e,{x:r.x&&g(l,"x",e)?a:1,y:r.y&&g(l,"y",e)?a:1,focalPoint:{x:o.x-i.left,y:o.y-i.top}}),t.scale=n.scale)}function D(e,t,n){var o=t.delta;o&&(t.panning=!0,P(e,{x:n.deltaX-o.x,y:n.deltaY-o.y},t.panScales),t.delta={x:n.deltaX,y:n.deltaY})}const T=new WeakMap;function H(l,e){const c=x(l),t=l.canvas,{pan:n,zoom:o}=e,a=new s.default.Manager(t);var i,r;o&&o.pinch.enabled&&(a.add(new s.default.Pinch),a.on("pinchstart",()=>{var e=c;e.options.zoom.pinch.enabled&&(e.scale=1)}),a.on("pinch",e=>X(l,c,e)),a.on("pinchend",e=>{var t=l,n=c;n.scale&&(X(t,n,e),n.scale=null,p.callback(n.options.zoom.onZoomComplete,[{chart:t}]))})),n&&n.enabled&&(a.add(new s.default.Pan({threshold:n.threshold,enable:(i=l,r=c,function(e,t){var{pan:n,zoom:o={}}=r.options;if(!n||!n.enabled)return!1;var a=t&&t.srcEvent;return!(a&&!r.panning&&"mouse"===t.pointerType&&(d(m(n),a)||u(m(o.drag),a))&&(p.callback(n.onPanRejected,[{chart:i,event:t}]),1))})})),a.on("panstart",e=>{var t=l,n=c,{enabled:o,overScaleMode:a,onPanStart:i,onPanRejected:r}=n.options.pan;if(o)return o=e.target.getBoundingClientRect(),!(o={x:e.center.x-o.left,y:e.center.y-o.top})===p.callback(i,[{chart:t,event:e,point:o}])?p.callback(r,[{chart:t,event:e}]):(n.panScales=a&&h(a,o,t),n.delta={x:0,y:0},clearTimeout(n.panEndTimeout),void D(t,n,e))}),a.on("panmove",e=>D(l,c,e)),a.on("panend",()=>{var e=l,t=c;t.delta=null,t.panning&&(t.panEndTimeout=setTimeout(()=>t.panning=!1,500),p.callback(t.options.pan.onPanComplete,[{chart:e}]))})),T.set(l,a)}t={id:"zoom",version:"1.1.1",defaults:{pan:{enabled:!1,mode:"xy",threshold:10,modifierKey:null},zoom:{wheel:{enabled:!1,speed:.1,modifierKey:null},drag:{enabled:!1,modifierKey:null},pinch:{enabled:!1},mode:"xy"}},start:function(i,e,t){x(i).options=t,Object.prototype.hasOwnProperty.call(t.zoom,"enabled"),s.default&&H(i,t),i.pan=(e,t,n)=>P(i,e,t,n),i.zoom=(e,t)=>k(i,e,t),i.zoomScale=(e,t,n)=>{var[e,t,n,o="none"]=[i,e,t,n];z(e,x(e)),y(e.scales[t],n,void 0,!0),e.update(o)},i.resetZoom=e=>{{var[e,t="default"]=[i,e];const n=x(e),o=z(e,n);return p.each(e.scales,function(e){const t=e.options;o[e.id]?(t.min=o[e.id].min.options,t.max=o[e.id].max.options):(delete t.min,delete t.max)}),e.update(t),void p.callback(n.options.zoom.onZoomComplete,[{chart:e}])}},i.getZoomLevel=()=>{{var e=i;const a=x(e);let n=1,o=1;return p.each(e.scales,function(e){var t=function(e,t){var e=e.originalScaleLimits[t];if(e)return{min:t,max:e}=e,p.valueOrDefault(e.options,e.scale)-p.valueOrDefault(t.options,t.scale)}(a,e.id);if(t){const a=Math.round(t/(e.max-e.min)*100)/100;n=Math.min(n,a),o=Math.max(o,a)}}),n<1?n:o}}},beforeEvent(e){e=x(e);if(e.panning||e.dragging)return!1},beforeUpdate:function(e,t,n){x(e).options=n;var o,a,i,r=e.canvas,{wheel:n,drag:l,onZoomComplete:c}=n.zoom;n.enabled?(j(e,r,"wheel",F),o=e,n="onZoomComplete",i=250,(a=c)&&(x(o).handlers[n]=function(e,t){let n;return function(){return clearTimeout(n),n=setTimeout(e,t),t}}(()=>p.callback(a,[{chart:o}]),i))):C(e,"wheel"),l.enabled?(j(e,r,"mousedown",Y),j(e,r.ownerDocument,"mouseup",E)):(C(e,"mousedown"),C(e,"mousemove"),C(e,"mouseup"))},beforeDatasetsDraw:function(e,t,n){var{dragStart:o,dragEnd:a}=x(e);if(a){const{left:t,top:i,width:r,height:l}=L(e,n.zoom.mode,o,a),c=n.zoom.drag,s=e.ctx;s.save(),s.beginPath(),s.fillStyle=c.backgroundColor||"rgba(225,225,225,0.3)",s.fillRect(t,i,r,l),0<c.borderWidth&&(s.lineWidth=c.borderWidth,s.strokeStyle=c.borderColor||"rgba(225,225,225)",s.strokeRect(t,i,r,l)),s.restore()}},stop:function(e){if(C(t=e,"mousedown"),C(t,"mousemove"),C(t,"mouseup"),C(t,"wheel"),C(t,"click"),s.default){t=e;const n=T.get(t);n&&(n.remove("pinchstart"),n.remove("pinch"),n.remove("pinchend"),n.remove("panstart"),n.remove("pan"),n.remove("panend"),n.destroy(),T.delete(t))}var t;t=e,o.delete(t)},panFunctions:f,zoomFunctions:c};return e.Chart.register(t),t});